
<font color=blue> Привет еще раз. Спасибо, что доделал работу. Мои комментарии на этот раз выделены синим цветом.
    
---

---
## Комментарий от наставника

Привет! Спасибо, что прислал задание:) Поздравляю с первым сданным проектом. В целом, работа производит неплохое впечатление, однако обрати внимание на некоторые мои комментарии. Они обозначены пометкой **Комментарий от наставника**. Пострайся учесть эти комментарии.

---

## Исследование надёжности заёмщиков

Заказчик — кредитный отдел банка. Нужно разобраться, влияет ли семейное положение и количество детей клиента на факт погашения кредита в срок. Входные данные от банка — статистика о платёжеспособности клиентов.

Результаты исследования будут учтены при построении модели **кредитного скоринга** — специальной системы, которая оценивает способность потенциального заёмщика вернуть кредит банку.

Описание данных
- children — количество детей в семье
- days_employed — общий трудовой стаж в днях
- dob_years — возраст клиента в годах
- education — уровень образования клиента
- education_id — идентификатор уровня образования
- family_status — семейное положение
- family_status_id — идентификатор семейного положения
- gender — пол клиента
- income_type — тип занятости
- debt — имел ли задолженность по возврату кредитов
- total_income — ежемесячный доход
- purpose — цель получения кредита

---
## Комментарий от наставника


Правильно, что есть краткое вступление в работу, описание того, что надо делать. В работе необходимо приводить краткий план того, что надо сделать(если этот план имеется), а также информацию о входных данных: какие столбцы есть в таблице, их названия и какую информацию они несут (см. пример). Также название работы лучше отображать в отдельной ячейке и делать крупный шрифт (заголовок). Так работа выглядит презентабельно.

<font color=red> Пример: </font>
---
Описание данных: 
- children — количество детей в семье
- days_employed — общий трудовой стаж в днях
- dob_years — возраст клиента в годах
- education — уровень образования клиента
- education_id — идентификатор уровня образования
- ...
    
    
---

### Шаг 1. Откройте файл с данными и изучите общую информацию. 


```python
import pandas as pd
clients = pd.read_csv('/datasets/data.csv')
```


```python
clients
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>-8437.673028</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875.639453</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>-4024.803754</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080.014102</td>
      <td>приобретение автомобиля</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>-5623.422610</td>
      <td>33</td>
      <td>Среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885.952297</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>-4124.747207</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628.550329</td>
      <td>дополнительное образование</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>340266.072047</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616.077870</td>
      <td>сыграть свадьбу</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>21520</td>
      <td>1</td>
      <td>-4529.316663</td>
      <td>43</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>224791.862382</td>
      <td>операции с жильем</td>
    </tr>
    <tr>
      <td>21521</td>
      <td>0</td>
      <td>343937.404131</td>
      <td>67</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>155999.806512</td>
      <td>сделка с автомобилем</td>
    </tr>
    <tr>
      <td>21522</td>
      <td>1</td>
      <td>-2113.346888</td>
      <td>38</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>1</td>
      <td>89672.561153</td>
      <td>недвижимость</td>
    </tr>
    <tr>
      <td>21523</td>
      <td>3</td>
      <td>-3112.481705</td>
      <td>38</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>1</td>
      <td>244093.050500</td>
      <td>на покупку своего автомобиля</td>
    </tr>
    <tr>
      <td>21524</td>
      <td>2</td>
      <td>-1984.507589</td>
      <td>40</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>82047.418899</td>
      <td>на покупку автомобиля</td>
    </tr>
  </tbody>
</table>
<p>21525 rows × 12 columns</p>
</div>




```python
clients.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21525 entries, 0 to 21524
    Data columns (total 12 columns):
    children            21525 non-null int64
    days_employed       19351 non-null float64
    dob_years           21525 non-null int64
    education           21525 non-null object
    education_id        21525 non-null int64
    family_status       21525 non-null object
    family_status_id    21525 non-null int64
    gender              21525 non-null object
    income_type         21525 non-null object
    debt                21525 non-null int64
    total_income        19351 non-null float64
    purpose             21525 non-null object
    dtypes: float64(2), int64(5), object(5)
    memory usage: 2.0+ MB


# Выводы

у датафрейма есть пропуски в столбце days_employed — общий трудовой стаж в днях и total_income — ежемесячный доход (это может быть связано что человек не предоставил оригиналы или заверенные копии трудовой книжки). 
по быстрому просмотру можно сделать выводы days_employed имеет ошибки, т.к. стаж не может быть отрицательным, и быть выше чем продолжительность жизни

---
## Комментарий от наставника

У меня имеется пара комментариев по данному шагу:
- считывание данных и импорт необходимых библиотек лучше проводить в разных ячейках;
- следует давать переменным осознанные имена. Таблица про клиентов - название надо бы выбрать соответствующее;
- Подумай также о возможных причинах появления пропусков, а также о том, являются ли они случайными или нет.

Первый взгляд на таблицу выполнен.

---

### Шаг 2. Предобработка данных

### Обработка пропусков


```python
def fix_days(age):
    return clients[clients['dob_years'] == age]['days_employed'].median()
clients.loc[clients['days_employed'].isnull(), 'days_employed'] = clients.loc[clients['days_employed'].isnull(), 'dob_years'].apply(fix_days)
```


```python
def fix_income(row):
    education_id = row['education_id']
    income_type = row['income_type']
    mask = (clients['total_income'].notnull()) & (clients['education_id'] == education_id) & (clients['income_type'] == income_type)
    return clients[mask]['total_income'].median()
clients.loc[clients['total_income'].isnull(), 'total_income'] = clients[clients['total_income'].isnull()].apply(fix_income, axis = 1)
```


```python
clients.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21525 entries, 0 to 21524
    Data columns (total 12 columns):
    children            21525 non-null int64
    days_employed       21525 non-null float64
    dob_years           21525 non-null int64
    education           21525 non-null object
    education_id        21525 non-null int64
    family_status       21525 non-null object
    family_status_id    21525 non-null int64
    gender              21525 non-null object
    income_type         21525 non-null object
    debt                21525 non-null int64
    total_income        21525 non-null float64
    purpose             21525 non-null object
    dtypes: float64(2), int64(5), object(5)
    memory usage: 2.0+ MB


### Вывод

Пропуски в стаже заменим по медиане взятой от возраста

Пропуски в доходе заменим медианой взятой от сочетаниям образования и типа занятости 

<font color=blue> Пропуски теперь обработаны верно. Интересный способ реализации заполнения пропусков, молодец. 
    
---

---
## Комментарий от наставника

Лучше использовать заполнение пропусков в соответствии с типом дохода. Тогда пенсионеры будут получать также, как и другие пенсионеры и т.д. Все-таки в данных есть достаточное число групп, заполнять пропуски в стаже, скажем, у студентов и пенсионеров одним и тем же значением не очень то правильно. То же самое касается и столбца с доходами: пропуски у предпринимателя и пенсионера заполняются одним числом, что вызывает вопросы. Подумай, как лучше обработать пропуски.

---

### Замена типа данных


```python
clients.loc[clients['days_employed'] < 0,['days_employed']] = clients.loc[clients['days_employed'] < 0,['days_employed']] * (-1)
```

Избавились от минусовых значений в стаже


```python
clients['dob_years'].max()
```




    75




```python
max_rab_hour= (75-18)*365
clients.loc[clients['days_employed'] >= max_rab_hour,['days_employed']]  = clients.loc[clients['days_employed'] >= max_rab_hour,['days_employed']] /24

clients.sort_values(by = 'days_employed', ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>16335</td>
      <td>1</td>
      <td>18388.949901</td>
      <td>61</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>186178.934089</td>
      <td>операции с недвижимостью</td>
    </tr>
    <tr>
      <td>4299</td>
      <td>0</td>
      <td>17615.563266</td>
      <td>61</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>122560.741753</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>6954</td>
      <td>0</td>
      <td>16739.808353</td>
      <td>56</td>
      <td>среднее</td>
      <td>1</td>
      <td>вдовец / вдова</td>
      <td>2</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>176278.441171</td>
      <td>ремонт жилью</td>
    </tr>
    <tr>
      <td>10006</td>
      <td>0</td>
      <td>16738.158823</td>
      <td>69</td>
      <td>высшее</td>
      <td>0</td>
      <td>Не женат / не замужем</td>
      <td>4</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>57390.256908</td>
      <td>получение образования</td>
    </tr>
    <tr>
      <td>7664</td>
      <td>1</td>
      <td>16736.462226</td>
      <td>61</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>126214.519212</td>
      <td>операции с жильем</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>2127</td>
      <td>1</td>
      <td>34.701045</td>
      <td>31</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>90557.994311</td>
      <td>получение образования</td>
    </tr>
    <tr>
      <td>9683</td>
      <td>0</td>
      <td>33.520665</td>
      <td>43</td>
      <td>среднее</td>
      <td>1</td>
      <td>Не женат / не замужем</td>
      <td>4</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>1</td>
      <td>128555.897209</td>
      <td>приобретение автомобиля</td>
    </tr>
    <tr>
      <td>6157</td>
      <td>2</td>
      <td>30.195337</td>
      <td>47</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>231461.185606</td>
      <td>свадьба</td>
    </tr>
    <tr>
      <td>8336</td>
      <td>0</td>
      <td>24.240695</td>
      <td>32</td>
      <td>высшее</td>
      <td>0</td>
      <td>Не женат / не замужем</td>
      <td>4</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>124115.373655</td>
      <td>получение дополнительного образования</td>
    </tr>
    <tr>
      <td>17437</td>
      <td>1</td>
      <td>24.141633</td>
      <td>31</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>1</td>
      <td>166952.415427</td>
      <td>высшее образование</td>
    </tr>
  </tbody>
</table>
<p>21525 rows × 12 columns</p>
</div>



Предположим что весь аномальный возраст эказан в часах и таким образом найдем все значения по условию что максимальный возраст заемщика из дата фрейма отнимаем 18 лет и делим все это значение на 24 тем самым получаем кол-во отработанных дней


```python
clients['days_employed'].max()
```




    18388.949900568383




```python
clients['education']=clients['education'].str.lower()
clients['family_status'] =  clients['family_status'].str.lower()

```


```python
sover = 365*14
a = clients.loc[clients['days_employed'] +sover  > clients['dob_years']*365]
print(a)

```

           children  days_employed  dob_years education  education_id  \
    18            0   16678.380705         53   среднее             1   
    98            0   15204.425239         54    высшее             0   
    99            0   14439.234121          0   среднее             1   
    149           0    2664.273168          0   среднее             1   
    157           0   14517.251167         38   среднее             1   
    ...         ...            ...        ...       ...           ...   
    21313         0    1268.487728          0   среднее             1   
    21340         2   16558.686086         51    высшее             0   
    21378         0   16719.031045         59   среднее             1   
    21433         0   16280.502364         57   среднее             1   
    21475         0   15217.221094         52   среднее             1   
    
                   family_status  family_status_id gender income_type  debt  \
    18            вдовец / вдова                 2      F   пенсионер     0   
    98           женат / замужем                 0      F   пенсионер     0   
    99           женат / замужем                 0      F   пенсионер     0   
    149                в разводе                 3      F   сотрудник     0   
    157          женат / замужем                 0      F   пенсионер     1   
    ...                      ...               ...    ...         ...   ...   
    21313  не женат / не замужем                 4      M   сотрудник     0   
    21340        женат / замужем                 0      F   пенсионер     0   
    21378         вдовец / вдова                 2      F   пенсионер     0   
    21433       гражданский брак                 1      F   пенсионер     0   
    21475        женат / замужем                 0      F   пенсионер     1   
    
            total_income                             purpose  
    18      56823.777243  на покупку подержанного автомобиля  
    98     199707.298524             покупка жилья для сдачи  
    99      71291.522491                          автомобиль  
    149     70176.435951                   операции с жильем  
    157    113560.650035                сделка с автомобилем  
    ...              ...                                 ...  
    21313  152419.184851                   операции с жильем  
    21340  130999.667269               заняться образованием  
    21378  204103.704870     операции со своей недвижимостью  
    21433  139742.106467               на проведение свадьбы  
    21475   48239.310903                     свой автомобиль  
    
    [996 rows x 12 columns]


Получаем 996 записей с артефактами, проверка на логику была такая что берем кол-во отработанных дней складываем с  совершеннолетие. Получается кол-во дней которое человек мог отработать если его стаж считать с первого дня   14 летия.





```python
clients = clients[clients['days_employed'] + sover <= clients['dob_years']*365]
```


```python
clients['children'].value_counts()
```




     0     13305
     1      4704
     2      2032
     3       323
     20       72
    -1        44
     4        40
     5         9
    Name: children, dtype: int64




```python
clients.loc[clients['children'] == 20,['children']] = 2
clients.loc[clients['children'] == -1,['children']] = 1

```


```python
clients['children'].value_counts()
```




    0    13305
    1     4748
    2     2104
    3      323
    4       40
    5        9
    Name: children, dtype: int64




```python
clients['days_employed'] = clients['days_employed'].astype('int64')
clients['total_income'] = clients['total_income'].astype('int64')
```

    /opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      """Entry point for launching an IPython kernel.
    /opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      



```python
clients.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 20529 entries, 0 to 21524
    Data columns (total 12 columns):
    children            20529 non-null int64
    days_employed       20529 non-null int64
    dob_years           20529 non-null int64
    education           20529 non-null object
    education_id        20529 non-null int64
    family_status       20529 non-null object
    family_status_id    20529 non-null int64
    gender              20529 non-null object
    income_type         20529 non-null object
    debt                20529 non-null int64
    total_income        20529 non-null int64
    purpose             20529 non-null object
    dtypes: int64(7), object(5)
    memory usage: 2.0+ MB


### Вывод

Мы избавились от пустых значений, выявили артефакты возраст - стаж (то что стаж + 18 летие) не может быть больше  возраста

а так же стаж и доход привели к целочисленному значению

<font color=blue> Тип данных изменен у необходимых столбцов. Все правильно. 
    
---

---
## Комментарий от наставника

Исходя из общей информации о таблице мы видим, что два столбца имеют вещественный тип данных, который и надо заменить на целочисленный. Это замена не произведена. Проведи замены типа для указанных столбцов. Здорово, что исправлены ошибки в данных. 

---

### Обработка дубликатов


```python
clients.duplicated().sum()
```




    71




```python
clients = clients.drop_duplicates().reset_index(drop=True)
```

### Вывод

Было найдено 71 запись дублирующая от которых мы избавились и можем приступить к лемматизаци


---
## Комментарий от наставника

Дубликаты вызывают смещение финальных результатов, поэтому их и надо удалять. Конечно, в данных нет уникального идентификатора, однако надо уметь удалять дубликаты. Метод drop_duplicates() использован верно.

---

### Лемматизация


```python
from pymystem3 import Mystem
m = Mystem()
purpose_uniq=clients['purpose'].unique()
#print(purpose_uniq)
for element in purpose_uniq:
    try:
        print(m.lemmatize(element))
    except:
        print ('Проверь цель', element)
def purpose_new(purpose):
    words= [
        ['жиль', 'недвижимость'],
        ['недвижимост','недвижимость'],
        ['свадьб','свадьба'],
        ['автомобил','автомобиль'],
        ['образован','образование']
    ]
    for word in words:
        if word[0] in purpose:
            return word[1]

clients['purpose_update']=clients['purpose'].apply(purpose_new)
clients.head(10)
    
```

    ['покупка', ' ', 'жилье', '\n']
    ['приобретение', ' ', 'автомобиль', '\n']
    ['дополнительный', ' ', 'образование', '\n']
    ['сыграть', ' ', 'свадьба', '\n']
    ['операция', ' ', 'с', ' ', 'жилье', '\n']
    ['образование', '\n']
    ['на', ' ', 'проведение', ' ', 'свадьба', '\n']
    ['покупка', ' ', 'жилье', ' ', 'для', ' ', 'семья', '\n']
    ['покупка', ' ', 'недвижимость', '\n']
    ['покупка', ' ', 'коммерческий', ' ', 'недвижимость', '\n']
    ['покупка', ' ', 'жилой', ' ', 'недвижимость', '\n']
    ['строительство', ' ', 'собственный', ' ', 'недвижимость', '\n']
    ['недвижимость', '\n']
    ['строительство', ' ', 'недвижимость', '\n']
    ['на', ' ', 'покупка', ' ', 'свой', ' ', 'автомобиль', '\n']
    ['на', ' ', 'покупка', ' ', 'подержать', ' ', 'автомобиль', '\n']
    ['операция', ' ', 'с', ' ', 'коммерческий', ' ', 'недвижимость', '\n']
    ['строительство', ' ', 'жилой', ' ', 'недвижимость', '\n']
    ['жилье', '\n']
    ['операция', ' ', 'со', ' ', 'свой', ' ', 'недвижимость', '\n']
    ['автомобиль', '\n']
    ['заниматься', ' ', 'образование', '\n']
    ['сделка', ' ', 'с', ' ', 'подержанный', ' ', 'автомобиль', '\n']
    ['получение', ' ', 'образование', '\n']
    ['автомобиль', '\n']
    ['свадьба', '\n']
    ['получение', ' ', 'дополнительный', ' ', 'образование', '\n']
    ['покупка', ' ', 'свой', ' ', 'жилье', '\n']
    ['операция', ' ', 'с', ' ', 'недвижимость', '\n']
    ['получение', ' ', 'высокий', ' ', 'образование', '\n']
    ['свой', ' ', 'автомобиль', '\n']
    ['сделка', ' ', 'с', ' ', 'автомобиль', '\n']
    ['профильный', ' ', 'образование', '\n']
    ['высокий', ' ', 'образование', '\n']
    ['покупка', ' ', 'жилье', ' ', 'для', ' ', 'сдача', '\n']
    ['на', ' ', 'покупка', ' ', 'автомобиль', '\n']
    ['ремонт', ' ', 'жилье', '\n']
    ['заниматься', ' ', 'высокий', ' ', 'образование', '\n']





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
      <th>purpose_update</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>8437</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875</td>
      <td>покупка жилья</td>
      <td>недвижимость</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>4024</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080</td>
      <td>приобретение автомобиля</td>
      <td>автомобиль</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>5623</td>
      <td>33</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885</td>
      <td>покупка жилья</td>
      <td>недвижимость</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>4124</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628</td>
      <td>дополнительное образование</td>
      <td>образование</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>14177</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616</td>
      <td>сыграть свадьбу</td>
      <td>свадьба</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0</td>
      <td>926</td>
      <td>27</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>255763</td>
      <td>покупка жилья</td>
      <td>недвижимость</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0</td>
      <td>2879</td>
      <td>43</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>240525</td>
      <td>операции с жильем</td>
      <td>недвижимость</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0</td>
      <td>152</td>
      <td>50</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>135823</td>
      <td>образование</td>
      <td>образование</td>
    </tr>
    <tr>
      <td>8</td>
      <td>2</td>
      <td>6929</td>
      <td>35</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>95856</td>
      <td>на проведение свадьбы</td>
      <td>свадьба</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0</td>
      <td>2188</td>
      <td>41</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>144425</td>
      <td>покупка жилья для семьи</td>
      <td>недвижимость</td>
    </tr>
  </tbody>
</table>
</div>



### Вывод

 С помощью лемматизации привели цели кредита к 5и общим целям которые встречаются по всему набору данных: Жилье, недвижимость, авто, образование и всё что связано со свадьбой  

---
## Комментарий от наставника

Все верно, метод lemmatize() использован правильно. Стоит подробнее объяснить выбор лемм.

---

### Категоризация данных


```python
def ch_group(b):

        if b == 1:
                return 'один'
        if b == 2:
                return 'двое'
        if b >= 3:
                return 'многодетные'
        return 'бездетные'
clients['ch_group'] = clients['children'].apply(ch_group)
print(clients.head(10))
```

       children  days_employed  dob_years education  education_id  \
    0         1           8437         42    высшее             0   
    1         1           4024         36   среднее             1   
    2         0           5623         33   среднее             1   
    3         3           4124         32   среднее             1   
    4         0          14177         53   среднее             1   
    5         0            926         27    высшее             0   
    6         0           2879         43    высшее             0   
    7         0            152         50   среднее             1   
    8         2           6929         35    высшее             0   
    9         0           2188         41   среднее             1   
    
          family_status  family_status_id gender income_type  debt  total_income  \
    0   женат / замужем                 0      F   сотрудник     0        253875   
    1   женат / замужем                 0      F   сотрудник     0        112080   
    2   женат / замужем                 0      M   сотрудник     0        145885   
    3   женат / замужем                 0      M   сотрудник     0        267628   
    4  гражданский брак                 1      F   пенсионер     0        158616   
    5  гражданский брак                 1      M   компаньон     0        255763   
    6   женат / замужем                 0      F   компаньон     0        240525   
    7   женат / замужем                 0      M   сотрудник     0        135823   
    8  гражданский брак                 1      F   сотрудник     0         95856   
    9   женат / замужем                 0      M   сотрудник     0        144425   
    
                          purpose purpose_update     ch_group  
    0               покупка жилья   недвижимость         один  
    1     приобретение автомобиля     автомобиль         один  
    2               покупка жилья   недвижимость    бездетные  
    3  дополнительное образование    образование  многодетные  
    4             сыграть свадьбу        свадьба    бездетные  
    5               покупка жилья   недвижимость    бездетные  
    6           операции с жильем   недвижимость    бездетные  
    7                 образование    образование    бездетные  
    8       на проведение свадьбы        свадьба         двое  
    9     покупка жилья для семьи   недвижимость    бездетные  



```python
def purpose_group(tip):
    if tip == 'недвижимость':
        return 'ипотека'
    if tip == 'автомобиль':
        return 'автокредит'
    if tip == 'образование':
        return 'образование'
    return 'свадьба'
clients ['purpose_group']=clients['purpose_update'].apply(purpose_group)
print(clients.head(10))
    
```

       children  days_employed  dob_years education  education_id  \
    0         1           8437         42    высшее             0   
    1         1           4024         36   среднее             1   
    2         0           5623         33   среднее             1   
    3         3           4124         32   среднее             1   
    4         0          14177         53   среднее             1   
    5         0            926         27    высшее             0   
    6         0           2879         43    высшее             0   
    7         0            152         50   среднее             1   
    8         2           6929         35    высшее             0   
    9         0           2188         41   среднее             1   
    
          family_status  family_status_id gender income_type  debt  total_income  \
    0   женат / замужем                 0      F   сотрудник     0        253875   
    1   женат / замужем                 0      F   сотрудник     0        112080   
    2   женат / замужем                 0      M   сотрудник     0        145885   
    3   женат / замужем                 0      M   сотрудник     0        267628   
    4  гражданский брак                 1      F   пенсионер     0        158616   
    5  гражданский брак                 1      M   компаньон     0        255763   
    6   женат / замужем                 0      F   компаньон     0        240525   
    7   женат / замужем                 0      M   сотрудник     0        135823   
    8  гражданский брак                 1      F   сотрудник     0         95856   
    9   женат / замужем                 0      M   сотрудник     0        144425   
    
                          purpose purpose_update     ch_group purpose_group  
    0               покупка жилья   недвижимость         один       ипотека  
    1     приобретение автомобиля     автомобиль         один    автокредит  
    2               покупка жилья   недвижимость    бездетные       ипотека  
    3  дополнительное образование    образование  многодетные   образование  
    4             сыграть свадьбу        свадьба    бездетные       свадьба  
    5               покупка жилья   недвижимость    бездетные       ипотека  
    6           операции с жильем   недвижимость    бездетные       ипотека  
    7                 образование    образование    бездетные   образование  
    8       на проведение свадьбы        свадьба         двое       свадьба  
    9     покупка жилья для семьи   недвижимость    бездетные       ипотека  



```python
clients['income_group']=pd.qcut(clients['total_income'], 5)
```

### Вывод

При помощи категоризации данных цели кредита привели 4 основным - ипотека, свадьба, образование и автокредит
а так же при помощи квантилии доход разделили на 5 групп


```python
clients.query("purpose_group == 'свадьба'").purpose.unique()
```




    array(['сыграть свадьбу', 'на проведение свадьбы', 'свадьба'],
          dtype=object)



---
## Комментарий от наставника

В лемму "потребительский" кредит входят только расходы на проведение свадьбы. Стоит переименовать ее. 

Категоризовать также надо и столбец с доходами. Это есть ниже, а должно быть в данном разделе. 

---

### Шаг 3. Ответьте на вопросы

- Есть ли зависимость между наличием детей и возвратом кредита в срок?


```python
clients['direction']=clients['debt']
print(clients.info())
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 20458 entries, 0 to 20457
    Data columns (total 17 columns):
    children            20458 non-null int64
    days_employed       20458 non-null int64
    dob_years           20458 non-null int64
    education           20458 non-null object
    education_id        20458 non-null int64
    family_status       20458 non-null object
    family_status_id    20458 non-null int64
    gender              20458 non-null object
    income_type         20458 non-null object
    debt                20458 non-null int64
    total_income        20458 non-null int64
    purpose             20458 non-null object
    purpose_update      20458 non-null object
    ch_group            20458 non-null object
    purpose_group       20458 non-null object
    income_group        20458 non-null category
    direction           20458 non-null int64
    dtypes: category(1), int64(8), object(8)
    memory usage: 2.5+ MB
    None



```python
deti_pivot = clients.pivot_table(index='ch_group', columns='debt', values='direction', aggfunc='count', fill_value=0)
deti_pivot['vozvrat'] = deti_pivot[1]/(deti_pivot[0]+deti_pivot[1]) 
deti_pivot = deti_pivot.sort_values(by='vozvrat', ascending = False)
#print ('{:>11} | {:>10} | {:>10} | {:>10}'.format('Наличие детей', 'Возраты', 'Невозвраты', '% невозратов'))
#for row in deti_pivot.iterrows():
    #print('{:>11} | {:>10.0f} | {:>10.0f} | {:>12.1%}'.format(row[0], row[1][0], row[1][1], row[1]['vozvrat']))
deti_pivot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>debt</th>
      <th>0</th>
      <th>1</th>
      <th>vozvrat</th>
    </tr>
    <tr>
      <th>ch_group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>двое</td>
      <td>1900</td>
      <td>201</td>
      <td>0.095669</td>
    </tr>
    <tr>
      <td>один</td>
      <td>4302</td>
      <td>436</td>
      <td>0.092022</td>
    </tr>
    <tr>
      <td>многодетные</td>
      <td>342</td>
      <td>30</td>
      <td>0.080645</td>
    </tr>
    <tr>
      <td>бездетные</td>
      <td>12227</td>
      <td>1020</td>
      <td>0.076999</td>
    </tr>
  </tbody>
</table>
</div>



### Вывод

Заемщики не имеющие детей более отвественно относятся к возврату займа.


```python
deti_pivot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>debt</th>
      <th>0</th>
      <th>1</th>
      <th>vozvrat</th>
    </tr>
    <tr>
      <th>ch_group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>двое</td>
      <td>1900</td>
      <td>201</td>
      <td>0.095669</td>
    </tr>
    <tr>
      <td>один</td>
      <td>4302</td>
      <td>436</td>
      <td>0.092022</td>
    </tr>
    <tr>
      <td>многодетные</td>
      <td>342</td>
      <td>30</td>
      <td>0.080645</td>
    </tr>
    <tr>
      <td>бездетные</td>
      <td>12227</td>
      <td>1020</td>
      <td>0.076999</td>
    </tr>
  </tbody>
</table>
</div>



---
## Комментарий от наставника

Лучше просто вывести таблицу. 

---

- Есть ли зависимость между семейным положением и возвратом кредита в срок?


```python
sm_pivot = clients.pivot_table(index='family_status', columns='debt', values='direction', aggfunc='count', fill_value=0)
sm_pivot['vozvrat'] = sm_pivot[1]/(sm_pivot[0]+sm_pivot[1]) 
sm_pivot = sm_pivot.sort_values(by='vozvrat', ascending = False)
sm_pivot
#print ('{:>20} | {:>10} | {:>10} | {:>10}'.format('Семейное положение', 'Возвраты', 'Невозвраты', '% невозратов'))
#for row in sm_pivot.iterrows():
    #print('{:>20} | {:>10.0f} | {:>10.0f} | {:>12.1%}'.format(row[0], row[1][0], row[1][1], row[1]['vozvrat']))
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>debt</th>
      <th>0</th>
      <th>1</th>
      <th>vozvrat</th>
    </tr>
    <tr>
      <th>family_status</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>не женат / не замужем</td>
      <td>2441</td>
      <td>271</td>
      <td>0.099926</td>
    </tr>
    <tr>
      <td>гражданский брак</td>
      <td>3589</td>
      <td>374</td>
      <td>0.094373</td>
    </tr>
    <tr>
      <td>женат / замужем</td>
      <td>10866</td>
      <td>903</td>
      <td>0.076727</td>
    </tr>
    <tr>
      <td>в разводе</td>
      <td>1053</td>
      <td>83</td>
      <td>0.073063</td>
    </tr>
    <tr>
      <td>вдовец / вдова</td>
      <td>822</td>
      <td>56</td>
      <td>0.063781</td>
    </tr>
  </tbody>
</table>
</div>



### Вывод

Наблюдается прямая корреляция семейного положения и возврата кредита: люди не имеющие официально зарегистрированного брака, в большей степени склонны не возвращать займ 

---
## Комментарий от наставника

Вывод не противоречит полученному результату. 

---

- Есть ли зависимость между уровнем дохода и возвратом кредита в срок?


```python
dh_pivot = clients.pivot_table(index='income_group', columns='debt', values='direction', aggfunc='count', fill_value=0)
dh_pivot['vozvrat'] = dh_pivot[1]/(dh_pivot[0]+dh_pivot[1]) 
dh_pivot = dh_pivot.sort_values(by='vozvrat', ascending = False)
dh_pivot
#print ('{:>20} | {:>10} | {:>10} | {:>10}'.format('Уровень дохода', 'Возвраты', 'Невозвраты', '% невозратов'))
#for row in dh_pivot.iterrows():
    #print('{} | {:>10.0f} | {:>10.0f} | {:>12.1%}'.format(row[0], row[1][0], row[1][1], row[1]['vozvrat']))
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>debt</th>
      <th>0</th>
      <th>1</th>
      <th>vozvrat</th>
    </tr>
    <tr>
      <th>income_group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(133621.8, 162087.6]</td>
      <td>3718</td>
      <td>374</td>
      <td>0.091398</td>
    </tr>
    <tr>
      <td>(99509.4, 133621.8]</td>
      <td>3746</td>
      <td>345</td>
      <td>0.084331</td>
    </tr>
    <tr>
      <td>(20666.999, 99509.4]</td>
      <td>3752</td>
      <td>340</td>
      <td>0.083089</td>
    </tr>
    <tr>
      <td>(162087.6, 215440.8]</td>
      <td>3753</td>
      <td>338</td>
      <td>0.082620</td>
    </tr>
    <tr>
      <td>(215440.8, 2265604.0]</td>
      <td>3802</td>
      <td>290</td>
      <td>0.070870</td>
    </tr>
  </tbody>
</table>
</div>



### Вывод

 Люди с наибольшим доходом и наименьшим более склонны к возврату кредита в срок, а вот люди со средним и миниальным доходом наоборт

---
## Комментарий от наставника

Верный способ категоризации с помощью квантилей данного столбца. Так группы получаются равного размера. Выводы будут надежными. 

---

- Как разные цели кредита влияют на его возврат в срок?


```python
purpose_pivot = clients.pivot_table(index='purpose_group', columns='debt', values='direction', aggfunc='count', fill_value=0)
purpose_pivot['vozvrat'] = purpose_pivot[1]/(purpose_pivot[0]+purpose_pivot[1]) 
purpose_pivot = purpose_pivot.sort_values(by='vozvrat', ascending = False)
purpose_pivot
#print ('{:>20} | {:>10} | {:>10} | {:>10}'.format('Цель кредита', 'Возвраты', 'Невозвраты', '% невозратов'))
#for row in purpose_pivot.iterrows():
    #print('{:>20} | {:>10.0f} | {:>10.0f} | {:>12.1%}'.format(row[0], row[1][0], row[1][1], row[1]['vozvrat']))
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>debt</th>
      <th>0</th>
      <th>1</th>
      <th>vozvrat</th>
    </tr>
    <tr>
      <th>purpose_group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>автокредит</td>
      <td>3738</td>
      <td>390</td>
      <td>0.094477</td>
    </tr>
    <tr>
      <td>образование</td>
      <td>3467</td>
      <td>361</td>
      <td>0.094305</td>
    </tr>
    <tr>
      <td>свадьба</td>
      <td>2033</td>
      <td>177</td>
      <td>0.080090</td>
    </tr>
    <tr>
      <td>ипотека</td>
      <td>9533</td>
      <td>759</td>
      <td>0.073747</td>
    </tr>
  </tbody>
</table>
</div>



### Вывод

Люди берующиие ипотеку возвращают займы чаще, чем люди берующие займ на авто и образование. 

---
## Комментарий от наставника

Здорово, что при анализе использован метод сводных таблиц. Он пригодится в дальнейших проектах.

Выводы верные по всем пунктам. 

---

### Шаг 4. Общий вывод

В ходе работы мы избавились от пропусков в стаже работы заменив его на медиану стажа людей аналогичного возраста
а так же пропуски в доходе были изменены на медиану взятой от сочетаниям образования и типа занятости.
Были удалены записи которые были казались абсурдными к примеру общий стаж + совершеннолетие больше чем возраст заемщика, очевидно что записи с ошибками.

была сделана категоризация данных, а так же сделаны квантилии по уровню дохода.

В ходе работы была выявлена тенденция что наиболее благоприятная группа для выдачи кредита это: люди когда-либо состоявшие в официальном браке, не имеющие детей, и целью кредита которых является ипотека.

А так же группа людей которые чаще всего не возвращают кредит это люди берующие автокредиты, не женатые и имеющие двоих детей)

Для получения итоговых данных использовал метод сводных таблиц 

<font color=blue> Выводы стали лучше. Приведены ответы на главные вопросы проекта. Также здорово, что описано то, что было сделано в работе. 
    
---

---
## Комментарий от наставника

Финальный вывод и есть главный результат твоей работы. Стоит писать его подробно по результатам проведенной работы. В нем можно приводить полученные в ходе работы значения. Также можно расписать все, что было сделано в работе.

---

<font color=blue> Помарки исправлены, и теперь работа выполнена хорошо. Успехов в дальнейших проектах :)
    
---

## Комментарий от наставника

- В начале работы следует описывать данные, с которыми работаешь;
- Используй альтернативный способ обработки пропусков;
- Тип данных надо изменить у столбцов со стажем и с доходами;
- Финальный вывод стоит писать подробно.

Ты проделал большую работу, молодец! Исправь отмеченные тут замечания, и получится очень достойная работа :)

-----

# Чек-лист готовности проекта

Поставьте 'x' в выполненных пунктах. Далее нажмите Shift+Enter.
